<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>dynamically shared objects</title>
	<meta name="description" content="">
	<meta name="author" content="adam pridgen">
	<link rel="shortcut icon" type="image/png" href="http://deeso.github.io/theme/images/icons/favicon.png">
	<link rel="shortcut icon" type="image/x-icon" href="http://deeso.github.io/images/favicon.ico">



	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://deeso.github.io/theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="http://deeso.github.io/theme/bootstrap.min.css" rel="stylesheet">
	<link href="http://deeso.github.io/theme/local.css" rel="stylesheet">
	<link href="http://deeso.github.io/theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->
<script type="text/javascript">
	var disqus_identifier = "posts/2014/04/radare-java-intro/";
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://dsocon.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
</head>
<body>
<a href="https://github.com/deeso/"><img style="position: absolute; top: 39px; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="http://deeso.github.io/">dynamically shared objects</a>
			<ul class="nav">
					<li><a href="/">Home</a></li>
					<li><a href="/pages/talks/">Talks</a></li>
					<li><a href="/pages/slides/">Slides</a></li>
					<li class="active"><a href="http://deeso.github.io/category/reverse-engineering">Reverse Engineering</a></li>
			</ul>
			<p class="pull-right"><a href="http://deeso.github.io/archives.html">[archives]</a> <a href="http://deeso.github.io/tags.html">[tags]</a> <a href="http://deeso.github.io/search.html">[search]</a> </p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
                        <div class="social">
			<h3>Links</h3>
			<ul style="list-style: none;">
				<li><a href="https://github.com/deeso">Github</a></li>
				<li><a href="https://bitbucket.org/deeso">Bitbucket</a></li>
				<li><a href="https://twitter.com/apridgen">Twitter</a></li>
				<li><a href="https://linkedin.com/in/-dso-">Linkedin</a></li>
			</ul>
                        </div> 
                        <div class="social">
			<h3>Feeds</h3>
			<ul style="list-style: none;">
				<li><a href="feeds/all.atom.xml">All posts</a></li>
			</ul>
                        </div>
		</div>
	  </div>
	  <div class="content">
	<div class='article'>
		<div class="page-header"><h1>Introduction to Radare Java Reverse Engineering</h1></div>
		<div class="well small"><a class="more" href="http://deeso.github.io/posts/2014/04/radare-java-intro/">Wed 09 April 2014</a>
by <a class="url fn" href="http://deeso.github.io/author/adam-pridgen.html">Adam Pridgen </a>
 in <a href="http://deeso.github.io/category/reverse-engineering">Reverse Engineering</a>
tags: <a href="http://deeso.github.io/tag/radare/">radare</a> <a href="http://deeso.github.io/tag/hacking/">hacking</a> <a href="http://deeso.github.io/tag/reverse-engineering/">reverse engineering</a> <a href="http://deeso.github.io/tag/java/">java</a> <a href="http://deeso.github.io/tag/coding/">coding</a> <a href="http://deeso.github.io/tag/frameworks/">frameworks</a> </div>
		<div><h2>0. Introduction</h2>
<p>Radare is a reverse engineering framework that was built to support a command line hacker's needs. The frame work supports a number of different architectures and binary formats, which range from esoteric languages like BrainFuck to more common binary formats like MS-DOS Portable Executables (PE) or the Executable Linker Format (ELF).  In the past Radare has had limited support for Java reverse engineering, but this support provided only a minimal amount of information like disassembly, symbols, and import information.  The Java support has recently been updated and set of new features were added to Radare to help facilitate the analysis of Java class and Java Archive (JAR) file formats.</p>
<p>The focus of this post is to introduce some of these new features in addition to providing a basic walk-through for using Radare as a reverse engineering tool againt a ZIP archive and Java class files.  Typically, Java can be decompiled using tools like JD-GUI, JAD, JODE, CFR, etc., but these tools run into limitations when they are used against malicious or intentionally obfuscated code.  The purpose of these Radare extensions is to give malware analysts and reverse engineers a set of tools that can be used  to analyze Java based malware.  </p>
<p>In general, Java malware is fairly easy to identify and classify based on the code, import libraries, and the methods used by those imports, but when an analyst is asked to enumerate the functionality or explain what it does, they could be left in the dark.  Before the commencement of this project, there were a limited set of tools and those tools were typically written in Java.  Its not to say tools written in Java are less effective, but rather these tools take advantage of implicit assumptions that are implicit if the code comes from a considerate compiler and is not obfuscated.</p>
<p>For example, I found that that the <strong>SYNTHETIC</strong> flags or attributes in methods, fields, or classes code or other artifacts could be used to hide artifacts from an analyst.  This particular case arises because the <strong>SYNTHETIC</strong> attribute is used to indicate compiler generated code, and a decompiler or other analysis tool might assume this is an artifact is only for a compiler.  In the case of JD-GUI, if a method is marked with the <strong>SYNTHETIC</strong> flag, the code will not be decompiled and displayed to the user.  This means that a smart malware author could conceal functionality in plain sight.  CFR actually decompiled this and presented it to the user.  This was verified by setting the <strong>SYNTHETIC</strong> flags on a method in a Java class file, and then then the method was decompiled with both JD-GUI and CFR.</p>
<p>The remainder of this post will provide a basic introduction to Radare, and the coming days there will be some additional posts about the Java extensions and how they can be used to help analyze Java malware.  The first two sections will talk about setting up the environment.  The remainder of the post will focus on how to enumerate, analyse, and extract files from a ZIP archives.  The last section will discuss how to move data from files to archives and archive files to disk with the yank command.</p>
<h2>1. Getting started</h2>
<p>Radare can be compiled from source, or if you want to use a clean environment, you can set up a docker image.  If you get radare from source, it can be retrieved from github.  If you want to go the docker route, simply install Docker and perform the following commands:</p>
<p>Initialize the Docker and run r2:</p>
<div class="highlight"><pre><span></span>$ cat radare2.docker &gt; Dockerfile
$ docker build -t r2/radare2 .
$ docker run -t  -i r2/radare2  /bin/bash
</pre></div>


<p>radare2.docker:</p>
<div class="highlight"><pre><span></span><span class="err">#</span> <span class="nt">using</span> <span class="nt">phusion</span><span class="o">/</span><span class="nt">baseimage</span> <span class="nt">as</span> <span class="nt">base</span> <span class="nt">image</span><span class="o">.</span> 
<span class="nt">FROM</span> <span class="nt">phusion</span><span class="o">/</span><span class="nt">baseimage</span><span class="p">:</span><span class="nd">0</span><span class="p">.</span><span class="nc">9</span><span class="p">.</span><span class="nc">9</span>

<span class="err">#</span> <span class="nt">Set</span> <span class="nt">correct</span> <span class="nt">environment</span> <span class="nt">variables</span><span class="o">.</span>
<span class="nt">ENV</span> <span class="nt">HOME</span> <span class="o">/</span><span class="nt">root</span>

<span class="err">#</span> <span class="nt">Regenerate</span> <span class="nt">SSH</span> <span class="nt">host</span> <span class="nt">keys</span><span class="o">.</span> <span class="nt">baseimage-docker</span> <span class="nt">does</span> <span class="nt">not</span> <span class="nt">contain</span> <span class="nt">any</span>
<span class="nt">RUN</span> <span class="o">/</span><span class="nt">etc</span><span class="o">/</span><span class="nt">my_init</span><span class="p">.</span><span class="nc">d</span><span class="o">/</span><span class="nt">00_regen_ssh_host_keys</span><span class="p">.</span><span class="nc">sh</span>

<span class="err">#</span> <span class="nt">Use</span> <span class="nt">baseimage-docker</span><span class="err">&#39;</span><span class="nt">s</span> <span class="nt">init</span> <span class="nt">system</span><span class="o">.</span>
<span class="nt">CMD</span> <span class="cp">[</span><span class="s2">&quot;/sbin/my_init&quot;</span><span class="cp">]</span>

<span class="err">#</span> <span class="nt">create</span> <span class="nt">code</span> <span class="nt">directory</span>
<span class="nt">RUN</span> <span class="nt">mkdir</span> <span class="o">/</span><span class="nt">opt</span><span class="o">/</span><span class="nt">code</span><span class="o">/</span>
<span class="err">#</span> <span class="nt">install</span> <span class="nt">packages</span> <span class="nt">required</span> <span class="nt">to</span> <span class="nt">compile</span> <span class="nt">vala</span> <span class="nt">and</span> <span class="nt">radare2</span>
<span class="nt">RUN</span> <span class="nt">apt-get</span> <span class="nt">update</span>
<span class="nt">RUN</span> <span class="nt">apt-get</span> <span class="nt">install</span> <span class="nt">-y</span> <span class="nt">software-properties-common</span> <span class="nt">python-all-dev</span> <span class="nt">wget</span>
<span class="nt">RUN</span> <span class="nt">apt-get</span> <span class="nt">install</span> <span class="nt">-y</span> <span class="nt">swig</span> <span class="nt">flex</span> <span class="nt">bison</span> <span class="nt">git</span> <span class="nt">gcc</span> <span class="nt">g</span><span class="o">++</span> <span class="nt">make</span> <span class="nt">pkg-config</span> <span class="nt">glib-2</span><span class="p">.</span><span class="nc">0</span>
<span class="nt">RUN</span> <span class="nt">apt-get</span> <span class="nt">install</span> <span class="nt">-y</span> <span class="nt">python-gobject-dev</span>

<span class="err">#</span> <span class="nt">compile</span> <span class="nt">vala</span>
<span class="nt">RUN</span> <span class="nt">cd</span> <span class="o">/</span><span class="nt">opt</span><span class="o">/</span><span class="nt">code</span><span class="o">;</span> <span class="nt">wget</span> <span class="nt">http</span><span class="o">://</span><span class="nt">download</span><span class="p">.</span><span class="nc">gnome</span><span class="p">.</span><span class="nc">org</span><span class="o">/</span><span class="nt">sources</span><span class="o">/</span><span class="nt">vala</span><span class="o">/</span><span class="nt">0</span><span class="p">.</span><span class="nc">24</span><span class="o">/</span><span class="nt">vala-0</span><span class="p">.</span><span class="nc">24</span><span class="p">.</span><span class="nc">0</span><span class="p">.</span><span class="nc">tar</span><span class="p">.</span><span class="nc">xz</span><span class="o">;</span> <span class="nt">tar</span> <span class="nt">-Jxf</span> <span class="nt">vala-0</span><span class="p">.</span><span class="nc">24</span><span class="p">.</span><span class="nc">0</span><span class="p">.</span><span class="nc">tar</span><span class="p">.</span><span class="nc">xz</span>
<span class="nt">RUN</span> <span class="nt">cd</span> <span class="o">/</span><span class="nt">opt</span><span class="o">/</span><span class="nt">code</span><span class="o">/</span><span class="nt">vala-0</span><span class="p">.</span><span class="nc">24</span><span class="p">.</span><span class="nc">0</span><span class="o">;</span> <span class="o">./</span><span class="nt">configure</span> <span class="nt">--prefix</span><span class="o">=/</span><span class="nt">usr</span> <span class="o">;</span> <span class="nt">make</span> <span class="o">&amp;&amp;</span> <span class="nt">make</span> <span class="nt">install</span>
<span class="err">#</span> <span class="nt">compile</span> <span class="nt">radare</span>
<span class="nt">RUN</span> <span class="nt">cd</span> <span class="o">/</span><span class="nt">opt</span><span class="o">/</span><span class="nt">code</span><span class="o">;</span> <span class="nt">git</span> <span class="nt">clone</span> <span class="nt">https</span><span class="o">://</span><span class="nt">github</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">radare</span><span class="o">/</span><span class="nt">radare2</span><span class="p">.</span><span class="nc">git</span><span class="o">;</span> <span class="nt">cd</span> <span class="nt">radare2</span><span class="o">;</span> <span class="o">./</span><span class="nt">sys</span><span class="o">/</span><span class="nt">all</span><span class="p">.</span><span class="nc">sh</span>

<span class="err">#</span> <span class="nt">Clean</span> <span class="nt">up</span> <span class="nt">APT</span> <span class="nt">when</span> <span class="nt">done</span><span class="o">.</span>
<span class="nt">RUN</span> <span class="nt">apt-get</span> <span class="nt">clean</span> <span class="o">&amp;&amp;</span> <span class="nt">rm</span> <span class="nt">-rf</span> <span class="o">/</span><span class="nt">var</span><span class="o">/</span><span class="nt">lib</span><span class="o">/</span><span class="nt">apt</span><span class="o">/</span><span class="nt">lists</span><span class="o">/*</span> <span class="o">/</span><span class="nt">tmp</span><span class="o">/*</span> <span class="o">/</span><span class="nt">var</span><span class="o">/</span><span class="nt">tmp</span><span class="o">/*</span>
</pre></div>


<h2>2. Creating the example file</h2>
<p>Lets start by writing a new file to disk using a hexlified string.  The below example will open an empty file and then write all the bytes to example.zip.</p>
<div class="highlight"><pre><span></span>$ zip example.zip anypkg/Attacker.class anypkg/BlyahaMuha.class
$ rax2 -S &lt; example.zip &gt; data.hex
$ cat data.hex
504b0304140000000800ce9a5242390493e76a05000&lt;truncated&gt;
</pre></div>


<p>Open an empty archive and write a hexlified string with <strong>wx</strong>:</p>
<div class="highlight"><pre><span></span>$ r2 -w example.zip
<span class="o">[</span>0x00000000<span class="o">]</span>&gt; wx 504b0304140000000800dd7c7f44195f7fd7f2020000ef0400003a001c0072657365617263685f646174612f6578706572696d656e742f6465636f6d70696c65722f64756d7065645f6a61725f6465632f632e636c617373555409000361d2395392c43e5375780b000104e803000004e8030000ad52cd4f135110ff3dbadb6dcb0205f9d002f2a5d8166c0501452ac216488ca02628849664b32c0b2ec2962c8b112f26c69b9ebce195c3269ef8484a2209dcfda35ce76df988c2d1cdbe79f37e33f3667ef3e6d7ef9fc7007a311142b38476091d126e49b82da1338232544610401517351188fc28221a41906b4154cbb88e6b5c34c868419d8c56d4cb68431d43209e9861e88c4fae68efb4f4aa662da7a71ddbb4968712972186faab1cf30a37e4952b23446ea014c18c6999ce30297a8abb3108d9c2a2c15035695ac6f3cdb505c37ea52dac1212992e6cdaba3161f28328dab3d57906b6c0202f1a3ac5289b4b4b864d371996ee5f115a361c65cb313618a21725bc58583174e72fa854155da653c51b9b567acddcd0d3cae8f4f840df987fb77dd9306e9d1ac2b96753fda9fed4e038dd4004584e461c8930042425c465a49026d4a4f5348c6edc95d0cbd07291bec472a260af69cef87bdd5877cc8245de1f186aaeea5d28a3affa5d93f1000f19ca9d42f68d668fdab6b645fd8b27f259fee603fc694badce266638f248c6309e50874ccb316c4a511bbfe271b8e76319f7d1c7298c32544c3b9afe764a5bf71f4202f12ccb676950049a31d00a73bea4c57810ed02181f2d92313a35d3ce6817938790f64861682419f441c90fae3d754d526a8ed61c2138770839b90fa588701115bbffc44528eee679dc171a6c5e4a6a1f5d992304e68e20527c245944f92142fbb8b78ddac66dc82e8493800bf1443840d72ec53451f6387aa8e45674d05e769e434025b2a4a711f4c8542621403c24f48c90963ddd3dcedfb7f852218110facfb83385cae4e57eac6151cf45f8008a0b472d6270ee580d0ca93961075373b1f9be5868fd07f9f5a0f405fcbe01edb4eed0ea8ebe74511bed745115ad76118966884454fff4edf5673035f71da179d5f58ed45c6cc73ba006e4d443648a185167d559d7fb5aea3a67b307d9a3a6339f0a952f9e11f0882ea10146f898c79f8c26c73fd04fd6360e04cf014284ff84f8a9a40b84a0aa8b521ac8dee44fd98d3f504b01021e03140000000800dd7c7f44195f7fd7f2020000ef0400003a0018000000000000000000a4810000000072657365617263685f646174612f6578706572696d656e742f6465636f6d70696c65722f64756d7065645f6a61725f6465632f632e636c617373555405000361d2395375780b000104e803000004e8030000504b0506000000000100010080000000660300000000
<span class="o">[</span>0x00000000<span class="o">]</span>&gt; q
</pre></div>


<h2>3. Enumerating Files in the Zip</h2>
<p>List the files in the example by opening the archive with the "<strong>zip://</strong>" uri.</p>
<div class="highlight"><pre><span></span>$ r2 zip://example.zip
<span class="m">0</span> anypkg/Attacker.class
<span class="m">1</span> anypkg/BlyahaMuha.class
</pre></div>


<p>Opening by index:</p>
<div class="highlight"><pre><span></span>$ r2 zip://example.zip::0
<span class="o">[</span>0x00000690<span class="o">]</span>&gt;
</pre></div>


<p>Opening by path:</p>
<div class="highlight"><pre><span></span>$ r2 zip://example.zip//anypkg/Attacker.class
<span class="o">[</span>0x00000690<span class="o">]</span>&gt;
</pre></div>


<h2>4. Enumerating Java Class File Information</h2>
<p>Radare provides some really good informational commands that are typically used for the basic file information, if the developer implements them.  For Java, a large number of the basic information is implemented.</p>
<ol>
<li><strong>if</strong> or <strong>ijf</strong>: list the the information related to the class file in standard or JSON output</li>
<li><strong>ii</strong> or <strong>iji</strong>: list the imported classes methods and fields used in the class file</li>
<li><strong>il</strong> or <strong>ijl</strong>: list all of classes/libraries used by the class file</li>
<li><strong>ic</strong> or <strong>ijc</strong>: list the class hierarchy for the current class file</li>
<li><strong>iz</strong> or <strong>ijZ</strong>: list the all the strings in the class file</li>
<li><strong>iS</strong> or <strong>ijS</strong>: show where where the CP array, fields array, methods array, and attributes array begins.</li>
</ol>
<p>Radare Java analysis contains several different features that will be covered in the future.  In general, the extension commands can be run with "<strong>java &lt;<em>command</em>&gt;</strong>" like "<strong>java resolve_cp d</strong>".  The "<strong>resolve_cp</strong>" command is used to resolve or identify Constant Pool objects in the class file by their index.  Below the <strong>java resolve_cp d</strong> will dump all the CP objects in the class file.</p>
<div class="highlight"><pre><span></span>[0x00000690]&gt; java resolve_cp d
MethodRef ConstantPool Type (1)         Offset: 0x0000000a      Class Index = 39
        Name and type Index = 87
MethodRef ConstantPool Type (2)         Offset: 0x0000000f      Class Index = 39
        Name and type Index = 88
String ConstantPool Type (3)    Offset: 0x00000014      String Index = 89
MethodRef ConstantPool Type (4)         Offset: 0x00000017      Class Index = 38
        Name and type Index = 90
FieldRef ConstantPool Type (5)  Offset: 0x0000001c      Class Index = 38
        Name and type Index = 91
ClassRef ConstantPool Type (6)  Offset: 0x00000021      Name Index = 92
MethodRef ConstantPool Type (7)         Offset: 0x00000024      Class Index = 6
&lt;snip&gt;
</pre></div>


<p>For more information on the extensions, checkout "java help".  Note some of the commands will not work if analysis is not performed.  Before discussing the code analysis, lets briefly cover some additional information that is provided when Radare reports the class files's sections and symbols.  JVM class files are very good about separating code and data while including alot of meta-information that can be used for reversing or modifying the class file without lifting it back to source (e.g. decompiling).  In the symbols list (e.g. is), the descriptor notes whether a field or method are <strong>FUNC</strong>, <strong>FUNC_META</strong>, <strong>FIELD</strong>, or <strong>FIELD_META</strong>.  In these cases, the <strong>*_META</strong> points to the start of the meta-information, and <strong>FUNC</strong> will point to the actual code.  In the case of <strong>FIELD</strong> and <strong>FIELD_META</strong>, they will point to the same location because the <strong>FIELD</strong> is used to more or less to hold values, which only exist if the value is a constant.</p>
<p>Below shows the output of the <strong>is</strong>, which will output the symbol information for the class file.</p>
<div class="highlight"><pre><span></span>[0x00000690]&gt; is
[Symbols]
addr=0x00000690 off=0x00000690 ord=000 fwd=NONE sz=5 bind= type=FUNC name=_init_
addr=0x0000067a off=0x0000067a ord=000 fwd=NONE sz=61 bind=java/applet/Applet type=FUNC_META name=mmeta__init_
addr=0x000006cd off=0x000006cd ord=001 fwd=NONE sz=122 bind= type=FUNC name=init
addr=0x000006b7 off=0x000006b7 ord=001 fwd=NONE sz=361 bind=java/applet/Applet type=FUNC_META name=mmeta_init
addr=0x00000836 off=0x00000836 ord=002 fwd=NONE sz=105 bind=LOCAL type=FUNC name=createMe
addr=0x00000820 off=0x00000820 ord=002 fwd=NONE sz=295 bind=anypkg/Attacker type=FUNC_META name=mmeta_createMe
addr=0x0000095d off=0x0000095d ord=003 fwd=NONE sz=4 bind= type=FUNC name=getPath
addr=0x00000947 off=0x00000947 ord=003 fwd=NONE sz=42 bind=anypkg/Attacker type=FUNC_META name=mmeta_getPath
addr=0x00000987 off=0x00000987 ord=004 fwd=NONE sz=1 bind= type=FUNC name=main
addr=0x00000971 off=0x00000971 ord=004 fwd=NONE sz=57 bind=anypkg/Attacker type=FUNC_META name=mmeta_main
addr=0x000009c0 off=0x000009c0 ord=005 fwd=NONE sz=6 bind= type=FUNC name=_clinit_
addr=0x000009aa off=0x000009aa ord=005 fwd=NONE sz=44 bind=anypkg/Attacker type=FUNC_META name=mmeta__clinit_
addr=0x00000670 off=0x00000670 ord=000 fwd=NONE sz=8 bind= type=FIELD name=_lastParam
addr=0x00000670 off=0x00000670 ord=000 fwd=NONE sz=8 bind=anypkg/Attacker type=FIELD_META name=mmeta__lastParam

14 symbols
</pre></div>


<p>In the case of the sections, the sections of the file are broken down in the following manner:</p>
<ol>
<li><strong>constant_pool:</strong> Constant Pool Section (see JVM/class file spec.)</li>
<li><strong>fields:</strong> Start of the Actual Fields Array, (see JVM/class file spec.)</li>
<li><strong>attrs.&lt;<em>field_name</em>&gt;:</strong> Start of the attributes array for the given field, (see JVM/class file spec.)</li>
<li><strong>methods:</strong> Start of the Actual Methods Array, (see JVM/class file spec.)</li>
<li><strong>attrs.&lt;<em>method_name</em>&gt;:</strong> Start of the attributes array for the given method, (see JVM/class file spec.)</li>
</ol>
<p>Below are the sections reported by the <strong>iS</strong> command.  Note that the <strong>attr._lastParam</strong> in the <strong>iS</strong> does not have a corresponding section, because there is no attribute array for this field.</p>
<div class="highlight"><pre><span></span>[0x00000690]&gt; iS
[Sections]
idx=00 addr=0x0000066c off=0x0000066c sz=1630 vsz=0 perm=---- name=constant_pool
idx=01 addr=0x0000066e off=0x0000066e sz=10 vsz=0 perm=---- name=fields
idx=02 addr=0x00000678 off=0x00000678 sz=862 vsz=0 perm=---- name=methods
idx=03 addr=0x00000682 off=0x00000682 sz=69 vsz=0 perm=---- name=attrs._init_
idx=04 addr=0x000006bf off=0x000006bf sz=369 vsz=0 perm=---- name=attrs.init
idx=05 addr=0x00000828 off=0x00000828 sz=303 vsz=0 perm=---- name=attrs.createMe
idx=06 addr=0x0000094f off=0x0000094f sz=50 vsz=0 perm=---- name=attrs.getPath
idx=07 addr=0x00000979 off=0x00000979 sz=65 vsz=0 perm=---- name=attrs.main
idx=08 addr=0x000009b2 off=0x000009b2 sz=52 vsz=0 perm=---- name=attrs._clinit_
idx=09 addr=0x000009d6 off=0x000009d6 sz=10 vsz=0 perm=---- name=attributes

10 sections
</pre></div>


<h2>5. Yanking Around Files</h2>
<p>Some other neat features that were added to Radare as part of this project improved the file yanking capability.  Yanking, as the name implies, is the copying and pasting of bytes into a buffer or file.  This feature is enhanced by allowing files to yanked into or out of an archive.  For example, if an analyst is reversing a Java application, they might want to inject a class file into the archive or extract only a single file from the archive.  This means if a firmware images could also be manipulated in this manner, if the archive is implemented in the IO layer of Radare.</p>
<p>Examples below will demonstrate how to yank a file from an archive, print the disassembly, and then write the file to disk.  Another example will show how to yank code out of a Java function, and then paste this code into a file for further analysis.  A third example will show a file being added from the file system into the ZIP archive.</p>
<p>Before the demonstration, here is a quick summary of the commands used here:</p>
<ol>
<li><strong>yfa:</strong> yank the entire file into the yank buffer using the IO layer to retrieve the file</li>
<li><strong>yx:</strong> print the yanked buffer as hex shown with the offset, the hexlified-bytes, and then the bytes themselves.</li>
<li><strong>yy:</strong> paste the yank buffer to the given address or current location</li>
<li><strong>y:</strong> print a summary of the yank buffer</li>
<li><strong>wen:</strong> extend the buffer by N-bytes null bytes from the current position</li>
<li><strong>!ls -al:</strong> perform the shell command "<strong>ls -al</strong>"</li>
<li><strong>? x- y:</strong> perform the binary operation x-y and show the result</li>
<li><strong>wt <em>[filename]</em>:</strong> write the buffer to disk</li>
<li><strong>o- <em>[number]</em>:</strong> close the file</li>
<li><strong>o+ <em>[filename]</em>:</strong> open a file for write mode</li>
<li><strong>ib:</strong> reload the bin from the buffer</li>
</ol>
<h3>Yank the File from Buffer and Write to Disk</h3>
<p>Below is an example of opening Radare with a small (512 bytes) memory backed buffer.  This buffer will need to be resized with "<strong>wen</strong>" to accommodate the data from the target file, <strong>anypkg/Attacker.class</strong>, in the archive.  Then "<strong>yy</strong>' is used to paste the bytes,  and the "<strong>ib</strong>" (info buffer) command is used to reload the buffer to detect type of content and load it as a Java class file.  This class file will then be saved to disk with "<strong>wt</strong>".</p>
<div class="highlight"><pre><span></span><span class="nx">$</span> <span class="nx">r2</span> <span class="nx">zip</span><span class="o">:</span><span class="c1">//example.zip</span>
<span class="nx">Files</span> <span class="k">in</span> <span class="nx">archive</span>
<span class="mi">0</span> <span class="nx">anypkg</span><span class="o">/</span><span class="nx">Attacker</span><span class="p">.</span><span class="kr">class</span>
<span class="mi">1</span> <span class="nx">anypkg</span><span class="o">/</span><span class="nx">BlyahaMuha</span><span class="p">.</span><span class="kr">class</span>

<span class="nx">$</span> <span class="nx">r2</span> <span class="o">-</span>
<span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span><span class="o">&gt;</span> <span class="nx">yfa</span> <span class="nx">zip</span><span class="o">:</span><span class="c1">//example.zip::0; yx</span>
<span class="o">-</span> <span class="nx">offset</span> <span class="o">-</span>   <span class="mi">0</span> <span class="mi">1</span>  <span class="mi">2</span> <span class="mi">3</span>  <span class="mi">4</span> <span class="mi">5</span>  <span class="mi">6</span> <span class="mi">7</span>  <span class="mi">8</span> <span class="mi">9</span>  <span class="nx">A</span> <span class="nx">B</span>  <span class="nx">C</span> <span class="nx">D</span>  <span class="nx">E</span> <span class="nx">F</span>  <span class="mi">0123456789</span><span class="nx">ABCDEF</span>
<span class="mh">0x00000000</span>  <span class="nx">cafe</span> <span class="nx">babe</span> <span class="mi">0000</span> <span class="mi">0033</span> <span class="mi">0090</span> <span class="mi">0</span><span class="nx">a00</span> <span class="mi">2700</span> <span class="mi">570</span><span class="nx">a</span>  <span class="p">.......</span><span class="mi">3</span><span class="p">....</span><span class="s1">&#39;.W.</span>
<span class="s1">0x00000010  0027 0058 0800 590a 0026 005a 0900 2600  .&#39;</span><span class="p">.</span><span class="nx">X</span><span class="p">..</span><span class="nx">Y</span><span class="p">..</span><span class="o">&amp;</span><span class="p">.</span><span class="nx">Z</span><span class="p">..</span><span class="o">&amp;</span><span class="p">.</span>
<span class="mh">0x00000020</span>  <span class="mi">5</span><span class="nx">b07</span> <span class="mi">005</span><span class="nx">c</span> <span class="mi">0</span><span class="nx">a00</span> <span class="mi">0600</span> <span class="mi">5703</span> <span class="mi">0001</span> <span class="mi">86</span><span class="nx">a0</span> <span class="mi">0</span><span class="nx">a00</span>  <span class="p">[..</span><span class="err">\</span><span class="p">....</span><span class="nx">W</span><span class="p">.......</span>
<span class="mh">0x00000030</span>  <span class="mi">0600</span> <span class="mi">5</span><span class="nx">d07</span> <span class="mi">005</span><span class="nx">e</span> <span class="mi">0500</span> <span class="mi">0000</span> <span class="mi">0000</span> <span class="mi">0000</span> <span class="mi">640</span><span class="nx">a</span>  <span class="p">..]..</span><span class="o">^</span><span class="p">........</span><span class="nx">d</span><span class="p">.</span>
<span class="mh">0x00000040</span>  <span class="mi">005</span><span class="nx">f</span> <span class="mi">0060</span> <span class="mi">0700</span> <span class="mi">610</span><span class="nx">a</span> <span class="mi">001</span><span class="nx">b</span> <span class="mi">0062</span> <span class="mi">0</span><span class="nx">a00</span> <span class="mi">1800</span>  <span class="p">.</span><span class="nx">_</span><span class="p">.</span><span class="sb">`..a....b....</span>
<span class="sb">0x00000050  6307 0046 0a00 2600 6407 0065 0800 6608  c..F..&amp;.d..e..f.</span>
<span class="sb">0x00000060  0067 0800 680a 0020 0069 0700 6a07 0039  .g..h.. .i..j..9</span>
<span class="sb">0x00000070  0a00 1800 6b07 006c 0a00 6d00 6e07 006f  ....k..l..m.n..o</span>
<span class="sb">0x00000080  0a00 1d00 5708 0070 0700 7108 0072 0700  ....W..p..q..r..</span>
<span class="sb">0x00000090  730a 0022 0074 0a00 1d00 750a 001d 0076  s..&quot;.t....u....v</span>
<span class="sb">0x000000a0  0700 7707 0078 0100 0a5f 6c61 7374 5061  ..w..x..._lastPa</span>
<span class="sb">0x000000b0  7261 6d01 0012 4c6a 6176 612f 6c61 6e67  ram...Ljava/lang</span>
<span class="sb">0x000000c0  2f53 7472 696e 673b 0100 063c 696e 6974  /String;...&lt;init</span>
<span class="sb">&lt;snip&gt;</span>

<span class="sb">[0x00000000]&gt; if</span>
<span class="sb">file    malloc://512</span>
<span class="sb">fd      2946784</span>
<span class="sb">size    0x200</span>
<span class="sb">mode    rw-</span>
<span class="sb">block   0x100</span>
<span class="sb">uri     malloc://512</span>

<span class="sb">[0x00000000]&gt; y</span>
<span class="sb">0xffffffffffffffff 2528 cafebabe0000003300900a002700570a002700580800590a0026005a090026005b&lt;truncated&gt;</span>

<span class="sb">[0x00000000]&gt; ? 2528-0x200</span>
<span class="sb">2016 0x7e0 03740 1.0K 0000:07e0 2016 11100000 2016.0 0.000000</span>
<span class="sb">[0x00000000]&gt; wen 2016; yy; ib</span>
<span class="sb">[0x000009c0]&gt; if</span>
<span class="sb">file    malloc://512</span>
<span class="sb">type    JAVA CLASS</span>
<span class="sb">pic     false</span>
<span class="sb">has_va  false</span>
<span class="sb">root    classprint the disassembly</span>
<span class="sb">class   0x3300 0x0000</span>
<span class="sb">lang    java</span>
<span class="sb">arch    java</span>
<span class="sb">bits    32</span>
<span class="sb">machine Java VM</span>
<span class="sb">os      any</span>
<span class="sb">subsys  any</span>
<span class="sb">endian  little</span>
<span class="sb">strip   false</span>
<span class="sb">static  false</span>
<span class="sb">linenum true</span>
<span class="sb">lsyms   true</span>
<span class="sb">relocs  false</span>
<span class="sb">rpath   NONE</span>
<span class="sb">type    JAVA CLASS</span>
<span class="sb">os      any</span>
<span class="sb">arch    Java VM</span>
<span class="sb">bits    32</span>
<span class="sb">endian  little</span>
<span class="sb">file    malloc://512</span>
<span class="sb">fd      2791744</span>
<span class="sb">size    0x9e0</span>
<span class="sb">mode    rw-</span>
<span class="sb">block   0x100</span>
<span class="sb">uri     malloc://512</span>

<span class="sb">[0x000009c0]&gt; s sym.anypkg_Attacker.createMe; af; pdf</span>
<span class="sb">/ (fcn) sym.anypkg_Attacker.createMe 105</span>
<span class="sb">|          0x00000836    bb001d       new java/io/ByteArrayOutputStream </span>
<span class="sb">|          0x00000839    59           dup</span>
<span class="sb">|          0x0000083a    b7001e       invokespecial java/io/ByteArrayOutputStream/&lt;init&gt;()V</span>
<span class="sb">|             0x00000000()</span>
<span class="sb">|          0x0000083d    4c           astore_1</span>
<span class="sb">|          0x0000083e    01           aconst_null</span>
<span class="sb">|          0x0000083f    4d           astore_2</span>
<span class="sb">|          0x00000840    130018       ldc_w java/lang/Classprint the disassembly</span>
<span class="sb">|          0x00000843    121f         ldc &quot;getReso@urceA@sStream&quot;</span>
<span class="sb">&lt;snip&gt;</span>
<span class="sb">[0x00000836]&gt; wt Attacker.class</span>
<span class="sb">[0x00000836]&gt; !ls -al</span>
<span class="sb">total 4</span>
<span class="sb">drwxrwxr-x 5 dso dso 4096 Apr  8 20:33 .</span>
<span class="sb">drwxrwxr-x 6 dso dso 4096 Nov 21 19:33 ..</span>
<span class="sb">-rw-r--r-- 1 dso dso  256 Apr  8 20:33 Attacker.class</span>
<span class="sb">-rw-r--r-- 1 dso dso 2104 Apr  8 11:43 example.zip</span>
</pre></div>


<h3>Yank Some Code From the Archive and Paste to a File</h3>
<p>Below is an example of how to yank a method from a Java class file, and then paste it into a file for further analysis.  In this example, the <strong>Attacker.class</strong> will be opened from the JAR file, and analysis will be performed so that we can yank out the <em>createMe</em> method from this class.  Once the method is yanked, the class file will be closed and a new file <strong>createMe.method</strong> will be written to the disk.  Then this file will be opened, and the architecture will be set to java.  Afterwards, the assembly will be printed.  This technique can be used to save off interesting code, but note, the CP object reference resolutions will not be extracted with the code.</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">r2</span> <span class="nl">zip</span><span class="p">:</span><span class="c1">//example.zip//anypkg/Attacker.class</span>
<span class="p">[</span><span class="mh">0x00000690</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">af</span><span class="p">;</span> <span class="n">s</span> <span class="n">sym</span><span class="p">.</span><span class="n">anypkg_Attacker</span><span class="p">.</span><span class="n">createMe</span><span class="p">;</span> <span class="n">pdf</span>
<span class="o">/</span> <span class="p">(</span><span class="n">fcn</span><span class="p">)</span> <span class="n">sym</span><span class="p">.</span><span class="n">anypkg_Attacker</span><span class="p">.</span><span class="n">createMe</span> <span class="mi">105</span>
<span class="o">|</span>          <span class="mh">0x00000836</span>    <span class="n">bb001d</span>       <span class="n">new</span> <span class="n">java</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">ByteArrayOutputStream</span> 
<span class="o">|</span>          <span class="mh">0x00000839</span>    <span class="mi">59</span>           <span class="n">dup</span>
<span class="o">|</span>          <span class="mh">0x0000083a</span>    <span class="n">b7001e</span>       <span class="n">invokespecial</span> <span class="n">java</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">ByteArrayOutputStream</span><span class="o">/&lt;</span><span class="n">init</span><span class="o">&gt;</span><span class="p">()</span><span class="n">V</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">()</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x0000083d</span>    <span class="mi">4</span><span class="n">c</span>           <span class="n">astore_1</span>
<span class="o">|</span>          <span class="mh">0x0000083e</span>    <span class="mo">01</span>           <span class="n">aconst_null</span>
<span class="o">|</span>          <span class="mh">0x0000083f</span>    <span class="mi">4</span><span class="n">d</span>           <span class="n">astore_2</span>
<span class="o">|</span>          <span class="mh">0x00000840</span>    <span class="mi">130018</span>       <span class="n">ldc_w</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="kt">Class</span>
<span class="o">|</span>          <span class="mh">0x00000843</span>    <span class="mf">121f</span>         <span class="n">ldc</span> <span class="s">&quot;getReso@urceA@sStream&quot;</span>
<span class="o">|</span>          <span class="mh">0x00000845</span>    <span class="mi">1215</span>         <span class="n">ldc</span> <span class="s">&quot;@&quot;</span>
<span class="o">|</span>          <span class="mh">0x00000847</span>    <span class="mi">1216</span>         <span class="n">ldc</span> <span class="s">&quot;&quot;</span>
<span class="o">|</span>          <span class="mh">0x00000849</span>    <span class="n">b60017</span>       <span class="n">invokevirtual</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">String</span><span class="o">/</span><span class="n">replace</span><span class="p">(</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">CharSequence</span><span class="p">;</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">CharSequence</span><span class="p">;)</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">String</span><span class="p">;</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x0000084c</span>    <span class="mo">04</span>           <span class="n">iconst_1</span>
<span class="o">|</span>          <span class="mh">0x0000084d</span>    <span class="n">bd0018</span>       <span class="n">anewarray</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="kt">Class</span> 
<span class="o">|</span>          <span class="mh">0x00000850</span>    <span class="mi">59</span>           <span class="n">dup</span>
<span class="o">|</span>          <span class="mh">0x00000851</span>    <span class="mo">03</span>           <span class="n">iconst_0</span>
<span class="o">|</span>          <span class="mh">0x00000852</span>    <span class="mi">130020</span>       <span class="n">ldc_w</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">String</span>
<span class="o">|</span>          <span class="mh">0x00000855</span>    <span class="mi">53</span>           <span class="n">aastore</span>
<span class="o">|</span>          <span class="mh">0x00000856</span>    <span class="n">b6001a</span>       <span class="n">invokevirtual</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="kt">Class</span><span class="o">/</span><span class="n">getMethod</span><span class="p">(</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">String</span><span class="p">;[</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="kt">Class</span><span class="p">;)</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">reflect</span><span class="o">/</span><span class="n">Method</span><span class="p">;</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x00000859</span>    <span class="mi">2</span><span class="n">a</span>           <span class="n">aload_0</span>
<span class="o">|</span>          <span class="mh">0x0000085a</span>    <span class="n">b6000f</span>       <span class="n">invokevirtual</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">Object</span><span class="o">/</span><span class="n">getClass</span><span class="p">()</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="kt">Class</span><span class="p">;</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x0000085d</span>    <span class="mo">04</span>           <span class="n">iconst_1</span>
<span class="o">|</span>          <span class="mh">0x0000085e</span>    <span class="n">bd001b</span>       <span class="n">anewarray</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">Object</span> 
<span class="o">|</span>          <span class="mh">0x00000861</span>    <span class="mi">59</span>           <span class="n">dup</span>
<span class="o">|</span>          <span class="mh">0x00000862</span>    <span class="mo">03</span>           <span class="n">iconst_0</span>
<span class="o">|</span>          <span class="mh">0x00000863</span>    <span class="mi">1221</span>         <span class="n">ldc</span> <span class="s">&quot;/x/Make@Som@eFun.cla@ss&quot;</span>
<span class="o">|</span>          <span class="mh">0x00000865</span>    <span class="mi">1215</span>         <span class="n">ldc</span> <span class="s">&quot;@&quot;</span>
<span class="o">|</span>          <span class="mh">0x00000867</span>    <span class="mi">1216</span>         <span class="n">ldc</span> <span class="s">&quot;&quot;</span>
<span class="o">|</span>          <span class="mh">0x00000869</span>    <span class="n">b60017</span>       <span class="n">invokevirtual</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">String</span><span class="o">/</span><span class="n">replace</span><span class="p">(</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">CharSequence</span><span class="p">;</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">CharSequence</span><span class="p">;)</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">String</span><span class="p">;</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x0000086c</span>    <span class="mi">53</span>           <span class="n">aastore</span>
<span class="o">|</span>          <span class="mh">0x0000086d</span>    <span class="n">b6001c</span>       <span class="n">invokevirtual</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">reflect</span><span class="o">/</span><span class="n">Method</span><span class="o">/</span><span class="n">invoke</span><span class="p">(</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">Object</span><span class="p">;[</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">Object</span><span class="p">;)</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">Object</span><span class="p">;</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x00000870</span>    <span class="n">c00022</span>       <span class="n">checkcast</span> <span class="n">java</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">InputStream</span> 
<span class="o">|</span>          <span class="mh">0x00000873</span>    <span class="mi">4</span><span class="n">d</span>           <span class="n">astore_2</span>
<span class="o">|</span>      <span class="p">,</span><span class="o">=&lt;</span> <span class="mh">0x00000874</span>    <span class="n">a70004</span>       <span class="k">goto</span> <span class="mh">0x0878</span> <span class="p">;</span> <span class="p">(</span><span class="n">sym</span><span class="p">.</span><span class="n">anypkg_Attacker</span><span class="p">.</span><span class="n">createMe</span><span class="p">)</span>
<span class="o">|</span>      <span class="o">|</span>   <span class="mh">0x00000877</span>    <span class="mi">4</span><span class="n">e</span>           <span class="n">astore_3</span>
<span class="o">|</span>      <span class="err">`</span><span class="o">-&gt;</span> <span class="mh">0x00000878</span>    <span class="mi">110800</span>       <span class="n">sipush</span> <span class="mi">2048</span>
<span class="o">|</span>          <span class="mh">0x0000087b</span>    <span class="n">bc08</span>         <span class="n">newarray</span> <span class="mi">8</span>
<span class="o">|</span>          <span class="mh">0x0000087d</span>    <span class="mi">3</span><span class="n">a04</span>         <span class="n">astore</span> <span class="mi">4</span>
<span class="o">|</span>          <span class="mh">0x0000087f</span>    <span class="mi">2</span><span class="n">c</span>           <span class="n">aload_2</span>
<span class="o">|</span>          <span class="mh">0x00000880</span>    <span class="mi">1904</span>         <span class="n">aload</span> <span class="mi">4</span>
<span class="o">|</span>          <span class="mh">0x00000882</span>    <span class="mo">03</span>           <span class="n">iconst_0</span>
<span class="o">|</span>          <span class="mh">0x00000883</span>    <span class="mi">1904</span>         <span class="n">aload</span> <span class="mi">4</span>
<span class="o">|</span>          <span class="mh">0x00000885</span>    <span class="n">be</span>           <span class="n">arraylength</span>
<span class="o">|</span>          <span class="mh">0x00000886</span>    <span class="n">b60023</span>       <span class="n">invokevirtual</span> <span class="n">java</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">InputStream</span><span class="o">/</span><span class="n">read</span><span class="p">([</span><span class="n">BII</span><span class="p">)</span><span class="n">I</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x00000889</span>    <span class="mi">59</span>           <span class="n">dup</span>
<span class="o">|</span>          <span class="mh">0x0000088a</span>    <span class="mi">3</span><span class="n">e</span>           <span class="n">istore_3</span>
<span class="o">|</span>          <span class="mh">0x0000088b</span>    <span class="mo">02</span>           <span class="n">iconst_m1</span>
<span class="o">|</span>     <span class="p">,</span><span class="o">==&lt;</span> <span class="mh">0x0000088c</span>    <span class="mf">9f</span><span class="mo">000</span><span class="n">e</span>       <span class="n">if_icmpeq</span> <span class="mh">0x089a</span>
<span class="o">|</span>     <span class="o">|</span>    <span class="mh">0x0000088f</span>    <span class="mi">2</span><span class="n">b</span>           <span class="n">aload_1</span>
<span class="o">|</span>     <span class="o">|</span>    <span class="mh">0x00000890</span>    <span class="mi">1904</span>         <span class="n">aload</span> <span class="mi">4</span>
<span class="o">|</span>     <span class="o">|</span>    <span class="mh">0x00000892</span>    <span class="mo">03</span>           <span class="n">iconst_0</span>
<span class="o">|</span>     <span class="o">|</span>    <span class="mh">0x00000893</span>    <span class="mi">1</span><span class="n">d</span>           <span class="n">iload_3</span>
<span class="o">|</span>     <span class="o">|</span>    <span class="mh">0x00000894</span>    <span class="n">b60024</span>       <span class="n">invokevirtual</span> <span class="n">java</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">ByteArrayOutputStream</span><span class="o">/</span><span class="n">write</span><span class="p">([</span><span class="n">BII</span><span class="p">)</span><span class="n">V</span>
<span class="o">|</span>     <span class="o">|</span>       <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="o">|</span>     <span class="o">|</span>    <span class="mh">0x00000897</span>    <span class="n">a7ffe8</span>       <span class="k">goto</span> <span class="mh">0x087f</span> <span class="p">;</span> <span class="p">(</span><span class="n">sym</span><span class="p">.</span><span class="n">anypkg_Attacker</span><span class="p">.</span><span class="n">createMe</span><span class="p">)</span>
<span class="o">|</span>     <span class="err">`</span><span class="o">--&gt;</span> <span class="mh">0x0000089a</span>    <span class="mi">2</span><span class="n">b</span>           <span class="n">aload_1</span>
<span class="o">|</span>          <span class="mh">0x0000089b</span>    <span class="n">b60025</span>       <span class="n">invokevirtual</span> <span class="n">java</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">ByteArrayOutputStream</span><span class="o">/</span><span class="n">toByteArray</span><span class="p">()[</span><span class="n">B</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="n">section</span><span class="p">.</span><span class="n">constant_pool</span>
<span class="err">\</span>          <span class="mh">0x0000089e</span>    <span class="n">b0</span>           <span class="n">areturn</span>

<span class="p">[</span><span class="mh">0x00000836</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">y</span> <span class="mi">105</span>
<span class="p">[</span><span class="mh">0x00000836</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">o</span>
<span class="o">-</span> <span class="mi">51309</span> <span class="nl">zip</span><span class="p">:</span><span class="c1">//example.zip//anypkg/Attacker.class @ 0x0 ; r</span>
<span class="p">[</span><span class="mh">0x00000836</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">o</span><span class="o">-</span> <span class="mi">51309</span>
<span class="p">[</span><span class="mh">0x00000836</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">o</span><span class="o">+</span> <span class="n">createMe</span><span class="p">.</span><span class="n">method</span>

<span class="p">[</span><span class="mh">0x00000836</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">s</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">yy</span><span class="p">;</span> <span class="o">!</span><span class="n">ls</span> <span class="o">-</span><span class="n">al</span>
<span class="n">total</span> <span class="mi">5</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">dso</span> <span class="n">dso</span> <span class="mi">4096</span> <span class="n">Apr</span>  <span class="mi">8</span> <span class="mi">20</span><span class="o">:</span><span class="mi">41</span> <span class="p">.</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">6</span> <span class="n">dso</span> <span class="n">dso</span> <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">21</span> <span class="mi">19</span><span class="o">:</span><span class="mi">33</span> <span class="p">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">dso</span> <span class="n">dso</span>  <span class="mi">256</span> <span class="n">Apr</span>  <span class="mi">8</span> <span class="mi">20</span><span class="o">:</span><span class="mi">33</span> <span class="n">Attacker</span><span class="p">.</span><span class="k">class</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">dso</span> <span class="n">dso</span>  <span class="mi">105</span> <span class="n">Apr</span>  <span class="mi">8</span> <span class="mi">20</span><span class="o">:</span><span class="mi">41</span> <span class="n">createMe</span><span class="p">.</span><span class="n">method</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">dso</span> <span class="n">dso</span> <span class="mi">2104</span> <span class="n">Apr</span>  <span class="mi">8</span> <span class="mi">11</span><span class="o">:</span><span class="mi">43</span> <span class="n">example</span><span class="p">.</span><span class="n">zip</span>
</pre></div>


<p>Now the code will be loaded from the createMe.method and the code will be disassembled with "<strong>pdn</strong>" (print disassembly of N bytes).  Next, the architecture will be switched to Java and "<strong>pdn</strong>" will be used again.  Note the pdn is used to disassemble up to the number of bytes passed to it.  In this case, 105 bytes are all that are in createMe.method, so only 105 bytes should be disassembled.</p>
<p>When <strong>pdn</strong> is first executed it is going to print <em>105</em> instructions from data interpretted as x86 machine code.</p>
<div class="highlight"><pre><span></span>$ r2 createMe.method 
<span class="o">[</span>0x00000000<span class="o">]</span>&gt; pdn <span class="m">105</span>
0x00000000   bb001d59b7 mov ebx, 0xb7591d00
0x00000005         001e add <span class="o">[</span>rsi<span class="o">]</span>, bl
0x00000007     4c014d13 add <span class="o">[</span>rbp+0x13<span class="o">]</span>, r9
0x0000000b         <span class="m">0018</span> add <span class="o">[</span>rax<span class="o">]</span>, bl
0x0000000d         121f adc bl, <span class="o">[</span>rdi<span class="o">]</span>
0x0000000f 12151216b600 adc dl, <span class="o">[</span>rip+0xb61612<span class="o">]</span>
0x00000015               <span class="m">17</span>  &lt;invalid&gt;
0x00000016         04bd add al, 0xbd
0x00000018         <span class="m">0018</span> add <span class="o">[</span>rax<span class="o">]</span>, bl
0x0000001a           <span class="m">59</span> pop rcx
0x0000001b         <span class="m">0313</span> add edx, <span class="o">[</span>rbx<span class="o">]</span>
0x0000001d         <span class="m">0020</span> add <span class="o">[</span>rax<span class="o">]</span>, ah
&lt;snip&gt;
0x00000061       a7ffe8 goto 0x0049
0x00000064           2b aload_1
0x00000065       b60025 invokevirtual <span class="o">(</span><span class="m">37</span><span class="o">)</span> INVALID CP_OBJ
0x00000068           b0 areturn
<span class="o">[</span>0x00000000<span class="o">]</span>&gt; 
</pre></div>


<p>After the architecture is switched to Java with <strong>e asm.arch=java</strong>, <strong>pdn</strong> prints <em>105</em> instructions disasembled as JVM bytecode.</p>
<div class="highlight"><pre><span></span>[0x00000000]&gt; e asm.arch=java; pdn 105
0x00000000       bb001d new (29) INVALID CP_OBJ
0x00000003           59 dup
0x00000004       b7001e invokespecial (30) INVALID CP_OBJ
0x00000007           4c astore_1
0x00000008           01 aconst_null
0x00000009           4d astore_2
&lt;snip&gt;
0x00000055           02 iconst_m1
0x00000056       9f000e if_icmpeq 0x0064
0x00000059           2b aload_1
0x0000005a         1904 aload 4
0x0000005c           03 iconst_0
0x0000005d           1d iload_3
0x0000005e       b60024 invokevirtual (36) INVALID CP_OBJ
0x00000061       a7ffe8 goto 0x0049
0x00000064           2b aload_1
0x00000065       b60025 invokevirtual (37) INVALID CP_OBJ
0x00000068           b0 areturn
[0x00000000]&gt;
</pre></div>


<h3>Yank Some Code into the Archive to a File</h3>
<p>Below is an example of how to yank a data from a file on disk and then written into a ZIP archive.    In the case of Java, this is a great way to inject class files into an archive (topic of future discussion).  In this case, the sb.class is going to be added to the example.zip archive without having to use the zip command.  Once added to the class, "<strong>ib</strong>" will be executed to load class file.  Then the radare session is quit, and the file is reloaded from the archive.</p>
<div class="highlight"><pre><span></span><span class="nx">$</span> <span class="nx">r2</span> <span class="nx">zip</span><span class="o">:</span><span class="c1">//example.zip</span>

<span class="nx">Files</span> <span class="k">in</span> <span class="nx">archive</span>
<span class="mi">0</span> <span class="nx">anypkg</span><span class="o">/</span><span class="nx">Attacker</span><span class="p">.</span><span class="kr">class</span>
<span class="mi">1</span> <span class="nx">anypkg</span><span class="o">/</span><span class="nx">BlyahaMuha</span><span class="p">.</span><span class="kr">class</span>

<span class="nx">$</span> <span class="nx">r2</span> <span class="nx">zip</span><span class="o">:</span><span class="c1">//example.zip//sb.class</span>
<span class="p">[</span><span class="nx">0000</span>:<span class="kt">0000</span><span class="p">]</span><span class="o">&gt;</span> <span class="nx">yfa</span> <span class="nx">sb</span><span class="p">.</span><span class="kr">class</span>
<span class="p">[</span><span class="nx">0000</span>:<span class="kt">0000</span><span class="p">]</span><span class="o">&gt;</span> <span class="nx">yy</span>
<span class="p">[</span><span class="nx">0000</span>:<span class="kt">0000</span><span class="p">]</span><span class="o">&gt;</span> <span class="nx">ib</span>
<span class="p">[</span><span class="nx">0000</span>:<span class="kt">1225</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">if</span>
<span class="nx">file</span>    <span class="nx">sb</span><span class="p">.</span><span class="kr">class</span>
<span class="nx">type</span>    <span class="nx">JAVA</span> <span class="nx">CLASS</span>
<span class="nx">pic</span>     <span class="kc">false</span>
<span class="nx">has_va</span>  <span class="kc">false</span>
<span class="nx">root</span>    <span class="kr">class</span>
<span class="kr">class</span>   <span class="mh">0x3200</span> <span class="mh">0x0000</span>
<span class="nx">lang</span>    <span class="nx">java</span>
<span class="nx">arch</span>    <span class="nx">java</span>
<span class="nx">bits</span>    <span class="mi">32</span>
<span class="nx">machine</span> <span class="nx">Java</span> <span class="nx">VM</span>
<span class="nx">os</span>      <span class="nx">any</span>
<span class="nx">subsys</span>  <span class="nx">any</span>
<span class="nx">endian</span>  <span class="nx">little</span>
<span class="nx">strip</span>   <span class="kc">false</span>
<span class="kr">static</span>  <span class="kc">false</span>
<span class="nx">linenum</span> <span class="kc">true</span>
<span class="nx">lsyms</span>   <span class="kc">true</span>
<span class="nx">relocs</span>  <span class="kc">false</span>
<span class="nx">rpath</span>   <span class="nx">NONE</span>
<span class="nx">type</span>    <span class="nx">JAVA</span> <span class="nx">CLASS</span>
<span class="nx">os</span>      <span class="nx">any</span>
<span class="nx">arch</span>    <span class="nx">Java</span> <span class="nx">VM</span>
<span class="nx">bits</span>    <span class="mi">32</span>
<span class="nx">endian</span>  <span class="nx">little</span>
<span class="nx">file</span>    <span class="nx">sb</span><span class="p">.</span><span class="kr">class</span>
<span class="nx">fd</span>      <span class="mi">5031</span>
<span class="nx">size</span>    <span class="mh">0x28e7</span>
<span class="nx">mode</span>    <span class="nx">r</span><span class="o">--</span>
<span class="nx">block</span>   <span class="mh">0x100</span>
<span class="nx">uri</span>     <span class="nx">zip</span><span class="o">:</span><span class="c1">//example.zip//sb.class</span>

<span class="p">[</span><span class="nx">0000</span>:<span class="kt">1225</span><span class="p">]</span><span class="o">&gt;</span> <span class="nx">q</span>

<span class="nx">$</span> <span class="nx">r2</span> <span class="nx">zip</span><span class="o">:</span><span class="c1">//example.zip//sb.class</span>
<span class="p">[</span><span class="mh">0x0000108c</span><span class="p">]</span><span class="o">&gt;</span> <span class="nx">af</span><span class="p">;</span><span class="nx">pdf</span>
<span class="err">/ (fcn) sym.java_lang_Object._init_ 16</span>
<span class="o">|</span>          <span class="mh">0x0000108c</span>    <span class="mi">2</span><span class="nx">a</span>           <span class="nx">aload_0</span>
<span class="o">|</span>          <span class="mh">0x0000108d</span>    <span class="nx">b7000a</span>       <span class="nx">invokespecial</span> <span class="nx">java</span><span class="o">/</span><span class="nx">lang</span><span class="o">/</span><span class="nb">Object</span><span class="o">/&lt;</span><span class="nx">init</span><span class="o">&gt;</span><span class="p">()</span><span class="nx">V</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="nx">section</span><span class="p">.</span><span class="nx">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x00001090</span>    <span class="mi">2</span><span class="nx">a</span>           <span class="nx">aload_0</span>
<span class="o">|</span>          <span class="mh">0x00001091</span>    <span class="nx">bb000c</span>       <span class="k">new</span> <span class="nx">java</span><span class="o">/</span><span class="nx">lang</span><span class="o">/</span><span class="nx">StringBuilder</span> 
<span class="o">|</span>          <span class="mh">0x00001094</span>    <span class="mi">59</span>           <span class="nx">dup</span>
<span class="o">|</span>          <span class="mh">0x00001095</span>    <span class="nx">b7000e</span>       <span class="nx">invokespecial</span> <span class="nx">java</span><span class="o">/</span><span class="nx">lang</span><span class="o">/</span><span class="nx">StringBuilder</span><span class="o">/&lt;</span><span class="nx">init</span><span class="o">&gt;</span><span class="p">()</span><span class="nx">V</span>
<span class="o">|</span>             <span class="mh">0x00000000</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">;</span> <span class="nx">section</span><span class="p">.</span><span class="nx">constant_pool</span>
<span class="o">|</span>          <span class="mh">0x00001098</span>    <span class="nx">b5000f</span>       <span class="nx">putfield</span> <span class="nx">sb</span><span class="o">/</span><span class="nx">thisSb</span> <span class="nx">Ljava</span><span class="o">/</span><span class="nx">lang</span><span class="o">/</span><span class="nx">StringBuilder</span><span class="p">;</span>
<span class="err">\</span>          <span class="mh">0x0000109b</span>    <span class="nx">b1</span>           <span class="k">return</span>

<span class="p">[</span><span class="mh">0x0000108c</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">if</span>
<span class="nx">file</span>    <span class="nx">sb</span><span class="p">.</span><span class="kr">class</span>
<span class="nx">type</span>    <span class="nx">JAVA</span> <span class="nx">CLASS</span>
<span class="nx">pic</span>     <span class="kc">false</span>
<span class="nx">has_va</span>  <span class="kc">false</span>
<span class="nx">root</span>    <span class="kr">class</span>
<span class="kr">class</span>   <span class="mh">0x3200</span> <span class="mh">0x0000</span>
<span class="nx">lang</span>    <span class="nx">java</span>
<span class="nx">arch</span>    <span class="nx">java</span>
<span class="nx">bits</span>    <span class="mi">32</span>
<span class="nx">machine</span> <span class="nx">Java</span> <span class="nx">VM</span>
<span class="nx">os</span>      <span class="nx">any</span>
<span class="nx">subsys</span>  <span class="nx">any</span>
<span class="nx">endian</span>  <span class="nx">little</span>
<span class="nx">strip</span>   <span class="kc">false</span>
<span class="kr">static</span>  <span class="kc">false</span>
<span class="nx">linenum</span> <span class="kc">true</span>
<span class="nx">lsyms</span>   <span class="kc">true</span>
<span class="nx">relocs</span>  <span class="kc">false</span>
<span class="nx">rpath</span>   <span class="nx">NONE</span>
<span class="nx">type</span>    <span class="nx">JAVA</span> <span class="nx">CLASS</span>
<span class="nx">os</span>      <span class="nx">any</span>
<span class="nx">arch</span>    <span class="nx">Java</span> <span class="nx">VM</span>
<span class="nx">bits</span>    <span class="mi">32</span>
<span class="nx">endian</span>  <span class="nx">little</span>
<span class="nx">file</span>    <span class="nx">sb</span><span class="p">.</span><span class="kr">class</span>
<span class="nx">fd</span>      <span class="mi">53803</span>
<span class="nx">size</span>    <span class="mh">0x28e7</span>
<span class="nx">mode</span>    <span class="nx">r</span><span class="o">--</span>
<span class="nx">block</span>   <span class="mh">0x100</span>
<span class="nx">uri</span>     <span class="nx">zip</span><span class="o">:</span><span class="c1">//example.zip//sb.class</span>
</pre></div>


<h2>6. Conclusions</h2>
<p>This concludes the initial post of the radare extensions for Java reverse engineering.  In the next few posts, there will be a more detailed discussion about how to perform in-depth Java reversing and analysis with Radare extensions for Java.</p>
<p>greetz: pancake, xvilka, zlul (resident fuzzer), jvoisin, maijin</p><script type= "text/javascript">
    if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
        var mathjaxscript = document.createElement('script');
        mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
        mathjaxscript.type = 'text/javascript';
        mathjaxscript.src = 'https:' == document.location.protocol
                ? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'
                : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
        mathjaxscript[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" +
            "    config: ['MMLorHTML.js']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    displayAlign: 'center'," +
            "    displayIndent: '0em'," +
            "    showMathMenu: true," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true," +
            "        preview: 'TeX'," +
            "    }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
    }
</script>
</div>
                    &rarr;<a href="http://deeso.github.io/posts/2014/04/radare-java-artifact-enumeration/">
                            Using Radare to Enumerate Artifacts in a Java Class File
                    </a>
		<div>
			<h2>Comments</h2>
<div id="disqus_thread"></div>		<div>
	</div>	
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; adam pridgen</p>
		</footer>
	  </div>

	</div>
</body>
</html>